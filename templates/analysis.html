{% extends 'base.html' %}
{% block navbar_analysis %}
<!-- Charts -->
<li class="nav-item active">
    <a class="nav-link" href="{% url 'analysis' %}">
        <i class="fas fa-chart-line"></i>
        <span>Analysis</span></a>
</li>
{% endblock %}
{% block content%}
<style>
    .prog{
    width: 150px;
    height: 150px;
    line-height: 150px;
    background: none;
    margin: 0 auto;
    box-shadow: none;
    position: relative;
}
.prog:after{
    content: "";
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 12px solid #fff;
    position: absolute;
    top: 0;
    left: 0;
}
.prog > span{
    width: 50%;
    height: 100%;
    overflow: hidden;
    position: absolute;
    top: 0;
    z-index: 1;
}
.prog .prog-left{
    left: 0;
}
.prog .prog-bar{
    width: 100%;
    height: 100%;
    background: none;
    border-width: 12px;
    border-style: solid;
    position: absolute;
    top: 0;
}
.prog .prog-left .prog-bar{
    left: 100%;
    border-top-right-radius: 80px;
    border-bottom-right-radius: 80px;
    border-left: 0;
    -webkit-transform-origin: center left;
    transform-origin: center left;
}
.prog .prog-right{
    right: 0;
}
.prog .prog-right .prog-bar{
    left: -100%;
    border-top-left-radius: 80px;
    border-bottom-left-radius: 80px;
    border-right: 0;
    -webkit-transform-origin: center right;
    transform-origin: center right;
    animation: loading-1 1.8s linear forwards;
}
.prog .prog-value{
    width: 90%;
    height: 90%;
    border-radius: 50%;
    background: #44484b;
    font-size: 24px;
    color: #fff;
    line-height: 135px;
    text-align: center;
    position: absolute;
    top: 5%;
    left: 5%;
}
.prog.blue .prog-bar{
    border-color: #0275d8;
}
.prog.blue .prog-left .prog-bar{
    animation: loading-2 1.5s linear forwards 1.8s;
}
.prog.yellow .prog-bar{
    border-color: #f0ad4e;
}
.prog.yellow .prog-left .prog-bar{
    animation: loading-3 1s linear forwards 1.8s;
}
.prog.red .prog-bar{
    border-color: #d9534f;
}
.prog.red .prog-left .prog-bar{
    animation: loading-4 0.4s linear forwards 1.8s;
}
.prog.green .prog-bar{
    border-color: #5cb85c;
}
.prog.green .prog-left .prog-bar{
    animation: loading-5 1.2s linear forwards 1.8s;
}
@keyframes loading-1{
    0%{
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
    }
    100%{
        -webkit-transform: rotate(180deg);
        transform: rotate(180deg);
    }
}
@keyframes loading-2{
    0%{
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
    }
    100%{
        -webkit-transform: rotate(144deg);
        transform: rotate(144deg);
    }
}
@keyframes loading-3{
    0%{
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
    }
    100%{
        -webkit-transform: rotate(90deg);
        transform: rotate(90deg);
    }
}
@keyframes loading-4{
    0%{
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
    }
    100%{
        -webkit-transform: rotate(36deg);
        transform: rotate(36deg);
    }
}
@keyframes loading-5{
    0%{
        -webkit-transform: rotate(0deg);
        transform: rotate(0deg);
    }
    100%{
        -webkit-transform: rotate(126deg);
        transform: rotate(126deg);
    }
}
@media only screen and (max-width: 990px){
    .prog{ margin-bottom: 20px; }
}



</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <h1 class="h3 mb-2 text-gray-800 mt-4">Analysis</h1>

    <!-- Content Row -->
    <div class="row container-fluid pt-4">

        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <div class="row">

                    <!-- default -->
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Jan</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.0 }} {{ monthlyColour.0 }}">
                                <span>{{ monthlyTotalPercentage.0 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.0 }} / ₹{{ budgetTotalList.0 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Feb</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.1 }} {{ monthlyColour.1 }}">
                                <span>{{ monthlyTotalPercentage.1 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.1 }} / ₹{{ budgetTotalList.1 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Mar</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.2 }} {{ monthlyColour.2 }}">
                                <span>{{ monthlyTotalPercentage.2 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.2 }} / ₹{{ budgetTotalList.2 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Apr</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.3 }} {{ monthlyColour.3 }}">
                                <span>{{ monthlyTotalPercentage.3 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.3 }} / ₹{{ budgetTotalList.3 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>May</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.4 }} {{ monthlyColour.4 }}">
                                <span>{{ monthlyTotalPercentage.4 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.4 }} / ₹{{ budgetTotalList.4 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Jun</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.5 }} {{ monthlyColour.5 }}">
                                <span>{{ monthlyTotalPercentage.5 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.5 }} / ₹{{ budgetTotalList.5 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Jul</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.6 }} {{ monthlyColour.6 }}">
                                <span>{{ monthlyTotalPercentage.6 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.6 }} / ₹{{ budgetTotalList.6 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Aug</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.7 }} {{ monthlyColour.7 }}">
                                <span>{{ monthlyTotalPercentage.7 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.7 }} / ₹{{ budgetTotalList.7 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Sep</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.8 }} {{ monthlyColour.8 }}">
                                <span>{{ monthlyTotalPercentage.8 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.8 }} / ₹{{ budgetTotalList.8 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Oct</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.9 }} {{ monthlyColour.9 }}">
                                <span>{{ monthlyTotalPercentage.9 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.9 }} / ₹{{ budgetTotalList.9 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Nov</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.10 }} {{ monthlyColour.10 }}">
                                <span>{{ monthlyTotalPercentage.10 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.10 }} / ₹{{ budgetTotalList.10 }}</h6>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2 py-2">
                        <div class="clearfix">
                            <h5>Dec</h5>
                            <div class="c100 p{{ monthlyTotalPercentage.11 }} {{ monthlyColour.11 }}">
                                <span>{{ monthlyTotalPercentage.11 }}%</span>
                                <div class="slice">
                                    <div class="bar"></div>
                                    <div class="fill"></div>
                                </div>
                            </div>
                            <h6>₹{{ monthlyTotal.11 }} / ₹{{ budgetTotalList.11 }}</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Area Chart -->
    <div class="col-xl-12 col-xs-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <div class="mx-auto d-flex">
                    <div class="row">
                        <div class="col">
                            <div class="mx-auto d-flex">
                                <form method="post">
                                    {% csrf_token %}
                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <div class="dropdown">
                                                    <select class=" form-control btn-user py-1 " id="month"
                                                            name="month" required>
                                                        <option value="Jan">Jan</option>
                                                        <option value="Feb">Feb</option>
                                                        <option value="Mar">Mar</option>
                                                        <option value="Apr">Apr</option>
                                                        <option value="May">May</option>
                                                        <option value="Jun">Jun</option>
                                                        <option value="Jul">Jul</option>
                                                        <option value="Aug">Aug</option>
                                                        <option value="Sep">Sept</option>
                                                        <option value="Oct">Oct</option>
                                                        <option value="Nov">Nov</option>
                                                        <option value="Dec">Dec</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <div class="dropdown">
                                                    <select class=" form-control btn-user py-1 " id="year"
                                                            name="year" required>
                                                        <option value="2011">2011</option>
                                                        <option value="2012">2012</option>
                                                        <option value="2013">2013</option>
                                                        <option value="2014">2014</option>
                                                        <option value="2015">2015</option>
                                                        <option value="2016">2016</option>
                                                        <option value="2017">2017</option>
                                                        <option value="2018">2018</option>
                                                        <option value="2019">2019</option>
                                                        <option selected value="2020">2020</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <button class="btn btn-primary mx-auto" name="setDateRange"
                                                    type="submit" value="setDateRange">
                                                Set
                                            </button>
                                        </div>
                                    </div>
                                </form>
                                <form method="get">
                                    <div class="col px-5">
                                        <button class="btn btn-primary mx-auto" formmethod="get" name="reset"
                                                type="submit" value="reset">
                                            Reset
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Line Chart -->
    <div class="col-xl-12 col-xs-12">
        {% if isEmpty == False %}
        <div class="card shadow mb-4">
            <!--Card: Display Month and Year-->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <div>
                    <div class="col">
                        <h3>Month: {{ charMonth }}</h3>
                    </div>
                    <div class="col">
                        <h3>Year: {{ year }}</h3>
                    </div>
                </div>
            </div>
            <!--Card: Display Chart Header-->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">LINE CHART</h6>
            </div>
            <!--Card: Display Chart Laptop-->
            <!-- Card Body -->
            <div class="card-body mb-5 d-none d-lg-block" style="height: 35rem;">
                <div class="chart-pie pt-4 pb-2 ">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
            <!--Card: Display Chart Mobile-->
            <div class="card-body mb-5 d-xl-none" style="height: 16rem;">
                <div class="chart-pie pt-4 pb-2 ">
                    <canvas id="barChartPhone"></canvas>
                </div>
            </div>
        </div>
        {% else %}
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">LINE CHART</h6>
            </div>
            <div class="card-body">
                <p>You have not recorded any transactions yet. You can
                    <a href="{% url 'manual' %}">Add Transactions Manually</a> or
                    <a href="{% url 'bill' %}">Add Transactions from bill.</a>
                </p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- EXPENSE BARS CARD-->
    <div class="col-xl-12 col-xs-12">
        {% if isEmpty == False %}
        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">EXPENSE BARS</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <div class="pb-4">
                            <h6> Automobile - {{ categoryTotal.0 }} / {{ budgetList.0 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.0 }}" role="progressbar"
                                     style="width: {{ progress.0 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Bank Transfer - {{ categoryTotal.1 }} / {{ budgetList.1 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.1}}" role="progressbar"
                                     style="width: {{ progress.1 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Cash Withdrawal - {{ categoryTotal.2 }} / {{ budgetList.2 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.2 }}" role="progressbar"
                                     style="width: {{ progress.2 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Education - {{ categoryTotal.3 }} / {{ budgetList.3 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.3 }}" role="progressbar"
                                     style="width: {{ progress.3 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Entertainment - {{ categoryTotal.4 }} / {{ budgetList.4 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.4 }}" role="progressbar"
                                     style="width: {{ progress.4 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Fine - {{ categoryTotal.5 }} / {{ budgetList.5 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.5 }}" role="progressbar"
                                     style="width: {{ progress.5 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Food - {{ categoryTotal.6 }} / {{ budgetList.6 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.6 }}" role="progressbar"
                                     style="width: {{ progress.6 }}%;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="pb-4">
                            <h6> Health care - {{ categoryTotal.7 }} / {{ budgetList.7 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.7 }}" role="progressbar"
                                     style="width: {{ progress.7 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Other - {{ categoryTotal.8 }} / {{ budgetList.8 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.8 }}" role="progressbar"
                                     style="width: {{ progress.8 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Paytm - {{ categoryTotal.9 }} / {{ budgetList.9 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.9 }}" role="progressbar"
                                     style="width: {{ progress.9 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Recharge - {{ categoryTotal.10 }} / {{ budgetList.10 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.10 }}" role="progressbar"
                                     style="width: {{ progress.10 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Shopping - {{ categoryTotal.11 }} / {{ budgetList.11 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.11 }}" role="progressbar"
                                     style="width: {{ progress.11 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> Travel - {{ categoryTotal.12 }} / {{ budgetList.12 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.12 }}" role="progressbar"
                                     style="width: {{ progress.12 }}%;">
                                </div>
                            </div>
                        </div>
                        <div class="pb-4">
                            <h6> UPI - {{ categoryTotal.13 }} / {{ budgetList.13 }}</h6>
                            <div class="progress" style="height: 20px;">
                                <div aria-valuemax="100"
                                     aria-valuemin="0" aria-valuenow="25"
                                     class="progress-bar bg-{{ colour.13 }}" role="progressbar"
                                     style="width: {{ progress.13 }}%;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">EXPENSE BARS</h6>
            </div>
            <div class="card-body">
                <p>You have not recorded any transactions yet. You can
                    <a href="{% url 'manual' %}">Add Transactions Manually</a> or
                    <a href="{% url 'bill' %}">Add Transactions from bill.</a>
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
var data1 = {{ categoryTotal }};
var data2 = {{ budgetList }};

var barChart = document.getElementById('barChart').getContext('2d');
var mixedChart = new Chart(barChart, {
    type: 'line',
    data: {
        datasets: [{
            label: 'Your Expenditure ',
            data: data1,
            backgroundColor: 'rgb(255 , 255, 0, 0)',
            borderColor: 'rgb(0, 255, 0, 0.5)',


        }, {
            label: 'Your Budget',
            data: data2,
            backgroundColor: 'rgb(0, 255, 0, 0)',
            borderColor: 'rgb(255, 0, 0, 1)',

        }],
        fill: false,
        labels: ["Automobile", "Bank Transfer", "Cash Withdrawal", "Education", "Entertainment", "Fine",
                  "Food", "Health care", "Other", "PayTM", "Recharge", "Shopping", "Travel", "UPI"]
    },
    options: {
    layout: {
            padding: {
                left: 50,
                right: 0,
                top: 0,
                bottom: 0
            }

             }
        }
});
</script>
{% endblock %}